<html>
    <head>
        <title></title>
        
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="//js.pusher.com/4.0/pusher.min.js"></script>
        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <!--<link rel="stylesheet" type="text/css" href="/Users/irenepolo/timBot/pushers/pushchat/templates/css/styles.css"/>
        -->
        <script type="text/javascript">
            $.ajax({
                type: "GET",
                url:"/ajax/get_languages/",
                dataType: "json",
                success: function (data) {
                    console.log('get_languages: SUCCESS!');
                    // console.log(data);
                    $.each(JSON.parse(data),function(i,obj) {
                        // alert(obj.language+":"+obj.name);
                        var div_data="<option value="+obj.language+">"+obj.name+"</option>";
                        // alert(div_data);
                        $(div_data).appendTo('#dialog_options');
                        $(div_data).appendTo('#translation_options'); 
                        // console.log(obj.name);
                            });   
                }
            });

            
            chat = 0;
            function chat_line() { 

                //PRINTS USER INPUT TO CHAT CONSOLE
                var x =  document.getElementById("btn-input").value; 
                var ul = document.getElementById("chat");
                var ul_li = document.createElement("ul");
                ul_li.appendChild(document.createTextNode(x));
                ul_li.setAttribute("id", "chat"+chat);
                ul_li.setAttribute("onclick", "show_translation(this)");
                ul.appendChild(ul_li);
                console.log(ul);

                //PRINTS ENTITIES FROM USER INPUT TO ENTITIES LIST
                $.ajax({
                    type: "POST",
                    url:"/ajax/get_entities/",
                    dataType: "json",
                    data: {
                        user_input : x,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function (data,) {
                        console.log('get_entities = SUCCESS!');
                        // console.log(data);
                        // console.log(data[0].name);
                        // console.log(data[0].metadata.wikipedia_url);

                        var count =1;
                        data.forEach(function(entity) {
                            
                            var x =  entity.name; 
                            var ul = document.getElementById("entity_list");
                            var li = document.createElement("li");
                            var a = document.createElement("a");
                            a.appendChild(document.createTextNode(x));
                            try{ 
                                a.setAttribute("href", entity.metadata.wikipedia_url);
                                li.appendChild(a)
                                li.setAttribute("id", "li"+count);
                                ul.appendChild(li);
                                count++;
                            }
                            catch(error) {
                                console.log('error handled')
                            }
                            
                        });

                        var list = document.getElementById("entity_list");
                        console.log(list)
                        for (; count >0; count--) {
                            var l = document.getElementById("li"+count);
                            console.log(l);
                        }
                    }
                });
                chat++;
                console.log("chat count: ", chat);
            }

            function show_translation(element) {
                console.log("SHOW TRANSLATION: ");
                console.log(element);
                var id = element.id;
                // console.log(id); //works up to here
                var x =  document.getElementById(id).textContent; 
                var y = $('#dialog_options option:selected').attr('value');
                var z = $('#translation_options option:selected').attr('value');

                var t;
                $.ajax({
                    type: "POST",
                    url:"/ajax/get_translation/",
                    dataType: "json",
                    data: {
                        user_input : x,
                        chat_lang : y,
                        translate_lang : z,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function (data,) {
                        console.log('get_translation = SUCCESS!');
                        console.log(data);

                        //append the translated test to
                        li = document.createElement("li");
                        li.appendChild(document.createTextNode(data.translatedText));
                        elem = document.getElementById(id);
                        elem.appendChild(li);
                        console.log(elem);


                    }
                });

                
            } 
       
        </script>
        
    </head>
    <body>
        <div class="container">
            
            <div class="row">
                <div class="col">
                    <form>
                        <div class="form-group">
                            <h3>Language Settings</h3>
                        </div>
                        <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                <label class="form-check-label" for="defaultCheck1">
                                  Show Translation
                                </label>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="exampleFormControlSelect1">Chat Language</label>
                            <select id="dialog_options" >
                                    <option value="select" name ="chat_lang" id = "chatting"></option>
                            </select>
                        </div>
                        <div class="form-group">
                                <label for="exampleFormControlSelect1">Translation Language</label>
                                <select id="translation_options" >
                                        <option value="select" name="translate_lang" id = "translating"></option>
                                </select>
                            </div>
                        
                    </form>
                </div>
                <div class="col-6">
                    <div class="panel panel-primary">

                        <div class="panel-heading">
                            <span class="glyphicon glyphicon-comment"></span> <h3>Foreign Language Acquisition Bot</h3>
                        </div>

                        <div class="panel-body" id="demo">
                    <!-- ul element holding chat messages -->
                            <ul class="chat" id="chat">
                            </ul>
                        </div>

                        <div class="panel-footer">
                            <div class="input-group">
                                <!-- text imput fot the messages to be typed into -->
                                <input id="btn-input" name="user_input" onfocus="this.value=''" class="form-control input-sm" placeholder="Type your message here..." type="text">
                                <span class="input-group-btn">
                                    <!--- send button for the chat box -->
                                    <button class="btn btn-warning btn-sm" id="btn-chat" onclick = "chat_line()">Send</button>
                                    <!-- <button class="btn btn-warning btn-sm" id="btn-chat" >Send</button> -->

                                </span>
                            </div>
                        </div>

                    </div>
                </div>

                <div class = "col">
                    <div class="panel-body" id="demo">
                        <div class="form-group">
                            <h3>Entities</h3>
                        </div>
                        <!-- ul element holding entities -->
                        <ul class="chat" id="entity_list">
                        </ul>   
                    </div>
                </div>

            </div>
        </div>


    
</body>

</html>